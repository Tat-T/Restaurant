@page
@model MyRazorApp.Pages.ZakazModel
@{
    ViewData["Title"] = "Zakaz";
    Layout = "/Pages/Shared/_LayoutRest.cshtml";
}

<div class="zakaz mt-4 p-3 rounded-4 w-50" style="margin-left: 25%;">
    <button type="button" class="btn-close position-absolute top-0 end-0 m-3" style=" box-shadow: none;
    outline: none;" aria-label="Close" data-bs-dismiss="modal" onclick="window.location.href='/Index';">
    </button>
    <h3 class="text-center mb-2">Заказ столиков</h3>
    <form method="post">
        <div class="mb-2">
            <label asp-for="Reservation.Name" class="form-label fw-semibold">Имя</label>
            <input asp-for="Reservation.Name" class="form-control border border-secondary focus-ring focus-ring-dark"
                placeholder="Ваше имя" required>
            <span asp-validation-for="Reservation.Name" class="text-danger"></span>
        </div>

        <div class="mb-2">
            <label asp-for="Reservation.Email" class="form-label fw-semibold">Email</label>
            <input asp-for="Reservation.Email" class="form-control border border-secondary focus-ring focus-ring-dark"
                placeholder="Ваш email" required>
            <span asp-validation-for="Reservation.Email" class="text-danger"></span>
        </div>

        <div class="mb-2">
            <label asp-for="Reservation.Phone" class="form-label fw-semibold">Номер телефона</label>
            <input asp-for="Reservation.Phone" class="form-control border border-secondary focus-ring focus-ring-dark"
                placeholder="Ваш номер телефона" required>
            <span asp-validation-for="Reservation.Phone" class="text-danger"></span>
        </div>

        <div class="mb-2">
            <label class="form-label fw-semibold">Выберите дату</label>
            <div>
                @foreach (var date in Model.AvailableDates)
                {
                    var isFullyBooked = Model.BookedDates.Contains(date.Date);
                    <button type="button" class="btn btn-dark m-1 date-btn" data-date="@date.ToString("yyyy-MM-dd")"
                        @(isFullyBooked ? "disabled" : "") onclick="selectDate('@date.ToString("yyyy-MM-dd")')">
                        @date.ToString("dd.MM.yyyy")
                    </button>
                }
            </div>
            <input type="hidden" asp-for="Reservation.ReservationDate" id="reservationDate" />
        </div>

        <div class="mb-2">
            <label class="form-label fw-semibold">Выберите время</label>
            <div id="time-buttons">
                @foreach (var time in Model.AvailableTimes)
                {
                    var isBooked = Model.BookedTimes.Contains(time);
                    <button type="button" class="btn btn-dark m-1 time-btn" data-time="@time.ToString(@"hh\:mm")"
                        @(isBooked ? "disabled" : "") onclick="selectTime('@time.ToString(@"hh\:mm")')">
                        @time.ToString(@"hh\:mm")
                    </button>
                }
            </div>
            <input type="hidden" asp-for="Reservation.ReservationTime" id="reservationTime" />
        </div>

        <div class="mb-2">
            <label asp-for="Reservation.Guests" class="form-label fw-semibold">Количество гостей</label>
            <input asp-for="Reservation.Guests" class="form-control border border-secondary focus-ring focus-ring-dark"
                placeholder="Количество человек" min="1" value="1" required>
            <span asp-validation-for="Reservation.Guests" class="text-danger"></span>
        </div>

        <div class="mb-2">
            <label asp-for="Reservation.Message" class="form-label fw-semibold">Дополнительные пожелания</label>
            <textarea asp-for="Reservation.Message"
                class="form-control border border-secondary focus-ring focus-ring-dark" rows="3"
                placeholder="Ваши пожелания"></textarea>
        </div>

        <div>
            <button type="submit" class="btn btn-dark w-100">Забронировать столик
            </button>
        </div>
    </form>
</div>
@section Scripts {
     <script>
        // Словарь забронированных слотов { "2025-08-30": ["12:00","13:00"] }
        var bookedSlots = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.BookedSlots));
    </script>
    <script src="~/js/zakaz.js"></script>
    <partial name="_ValidationScriptsPartial" />
}
